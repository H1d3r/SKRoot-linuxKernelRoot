<!DOCTYPE html>
<html lang="zh-CN">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>SKRoot Manager Web Server</title>
	<style>
		:root {
			--purple-200: #BB86FC;
			--purple-500: #6200EE;
			--purple-700: #3700B3;
			--accent: #ff00ff;
			--text-weak: #666;
			--tab-height: 60px;
			--tabbar-bg: #ffffff;
			--border: #e5e5e5;

			--tab-font-size: 15px;
			--tab-radius: 22px;
			--tab-gap: 10px;
			--tab-pill-inactive-bg: #EEEEEE;
			--tab-pill-inactive-text: #5F5F5F;
			--tab-pill-active-text: #FFFFFF;
			--tab-pill-active-gradient: linear-gradient(180deg, #7A3AFF 0%, #5E00FF 100%);
		}

		* {
			box-sizing: border-box;
		}

		html, body {
			height: 100%;
		}

		body {
			padding: 0;
			margin: 0;
			font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
			color: #111;
			background: #fff;
			/* 预留底部Tab空间，避免内容被遮挡 */
			padding-bottom: var(--tab-height);
		}

		h2 {
			margin: 0;
			padding: 4px 0;
			font-size: 20px;
		}

		.head-tip {
			font-size: 16px;
			font-weight: bold;
		}

		.desc-tip {
			margin-top: 10px;
			font-size: 12px;
		}

		.warning-tip {
			color: #ff0000;
			margin-top: 10px;
			font-size: 13px;
		}

		.first-part {
			display: flex;
			flex-direction: column;
		}

		.divider {
			width: 100%;
			height: 2px;
			background-color: #ff00ff;
			margin-top: 10px;
		}

		.second-part {
			display: flex;
		}

		.menu-list {
			display: flex;
			flex-direction: column;
			margin-top: 4px;
			margin-bottom: 10px;
		}

		.menu-head-text {
			font-size: 12px;
		}

		.vertical {
			display: flex;
			margin-left: 4px;
			margin-right: 4px;
			height: 100%;
			width: 2px;
			background-color: #ff00ff;
		}

		.output-list {
			display: flex;
			flex-direction: column;
			width: 100%;
			margin-top: 4px;
			margin-bottom: 10px;
		}

		.output-tool-list {
			display: flex;
		}

		.console {
			border: 1px solid #ddd;
			padding: 2px;
			min-height: 90%;
			width: 100% overflow-y: hidden;
			resize: none;
			margin-top: 0px;
			margin-left: 0px;
			font-size: 10px;
			border-radius: 2px;
		}

		.btn,
		.small-btn {
			display: inline-block;
			padding: 5px 15px;
			margin-left: 0px;
			border: none;
			background-color: var(--purple-500);
			color: white;
			cursor: hand;
			width: 150px;
			height: 50px;
			border-radius: 5px;
			box-shadow: 0 3px 6px rgba(0, 0, 0, 0.16), 0 3px 6px rgba(0, 0, 0, 0.23);
		}

		.btn {
			text-align: left;
			margin-bottom: 10px;
		}

		.btn:active,
		.small-btn:active {
			box-shadow: 0 2px 4px rgba(0, 0, 0, 0.16), 0 2px 3px rgba(0, 0, 0, 0.23);
			transform: translateY(1px);
		}

		.small-btn {
			margin-left: 4px;
			margin-bottom: 6px;
			width: 60px;
			height: 30px;
		}


		.tab-page {
			display: none;
		}

		.tab-page.active {
			display: block;
		}

		.tabbar {
			position: fixed;
			left: 0;
			right: 0;
			bottom: 0;
			height: var(--tab-height);
			background: var(--tabbar-bg);
			border-top: 1px solid var(--border);
			display: grid;
			grid-template-columns: repeat(4, 1fr);
			align-items: center;
			gap: var(--tab-gap);
			padding: 6px 10px calc(6px + env(safe-area-inset-bottom));
			z-index: 999;
			backdrop-filter: saturate(140%) blur(4px);
		}

		.tab-item {
			display: flex;
			align-items: center;
			justify-content: center;
			height: calc(var(--tab-height) - 16px);
			color: var(--tab-pill-inactive-text);
			background: var(--tab-pill-inactive-bg);
			text-decoration: none;
			font-size: var(--tab-font-size);
			line-height: 1;
			border-radius: var(--tab-radius);
			font-weight: 600;
			-webkit-tap-highlight-color: transparent;
			user-select: none;
			box-shadow: 0 1px 1.5px rgba(0, 0, 0, .06), 0 1px 2px rgba(0, 0, 0, .04);
			border: none;
		}

		.tab-item.active {
			color: var(--tab-pill-active-text);
			background: var(--tab-pill-active-gradient);
			box-shadow: 0 3px 10px rgba(98, 0, 238, .25);
		}

		/* 响应式：小屏堆叠 */
		@media (max-width: 640px) {
			.second-part {
				flex-direction: column;
			}

			.menu-list {
				min-width: 0;
			}

			.btn {
				width: 100%;
			}
		}

		/* Active/Focus 状态增强 */
		.tab-item:active {
			transform: translateY(1px);
		}

		.tab-item:focus-visible {
			outline: 2px solid rgba(98, 0, 238, .35);
			outline-offset: 2px;
		}
	</style>

	<script>
		let g_lastSuFullPath = '';
		let g_lastInputCmd = 'id';
		let g_lastRootExecPath = '';
		const g_userName = generateRandomString(32);
		function generateRandomString(length) {
			let result = '';
			let characters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';
			let charactersLength = characters.length;
			for (let i = 0; i < length; i++) {
				result += characters.charAt(Math.floor(Math.random() * charactersLength));
			}
			return result;
		}
		function heartbeat() {
			postText('/heartbeat');
		}

		window.onload = function () {
			setInterval(heartbeat, 500);
			switchTab('home');
		};

		function switchTab(tabId) {
			document.querySelectorAll('.tab-page').forEach(el => {
				el.classList.toggle('active', el.id === tabId);
			});
			document.querySelectorAll('.tab-item').forEach(btn => {
				const isActive = btn.dataset.tab === tabId;
				btn.classList.toggle('active', isActive);
				btn.setAttribute('aria-selected', String(isActive));
			});
			window.scrollTo({ top: 0, behavior: 'smooth' });
		}

		function copyToClipboard(text) {
			let tempTextarea = document.createElement('textarea');
			document.body.appendChild(tempTextarea);
			tempTextarea.value = text;
			tempTextarea.select();
			document.execCommand('copy');
			document.body.removeChild(tempTextarea);
		}

		function postText(path, bodyText = "") {
			const url = new URL(path, window.location.href);
			return fetch(url, { method: 'POST', body: bodyText });
		}

		function appendConsole(txt) {
			if (!txt || !txt.length) return;
			let consoleText = document.getElementById('console');
			consoleText.value += txt;
			consoleText.value += '\n\n';
			consoleText.scrollTop = consoleText.scrollHeight;
		}

		async function testInstallBtnClick() {
			const resp = await postText('/testInstall');
			if (resp.ok) {
				const data = await resp.json()
				appendConsole(data.content);
			} else alert('发送数据时发生错误');
		}

		async function runRootCmdBtnClick() {
			var shell = prompt("请输入ROOT命令:", g_lastInputCmd);
			if (!shell || !shell.length) return;
			g_lastInputCmd = shell;
			const resp = await postText('/runRootCmd', JSON.stringify({ cmd: shell }));
			if (resp.ok) {
				const data = await resp.json()
				appendConsole(data.content);
			} else alert('发送数据时发生错误');
		}

		async function rootExecProcBtnClick() {
			var path = prompt("请输入Linux可执行程序的文件位置:", g_lastRootExecPath);
			if (!path || !path.length) return;
			g_lastRootExecPath = path;
			const resp = await postText('/runExecProc', JSON.stringify({ path: path }));
			if (resp.ok) {
				const data = await resp.json()
				appendConsole(data.content);
			} else alert('发送数据时发生错误');
		}

		function copyConsoleBtnClick() {
			let consoleText = document.getElementById('console');
			copyToClipboard(consoleText.value);
			alert('已复制');
		}

		function clearConsoleBtnClick() {
			let consoleText = document.getElementById('console');
			consoleText.value = '';
		}

	</script>

</head>

<body>
	<div id="home" class="tab-page active" role="region" aria-label="主页">
		<div class="first-part">
			<span class="head-tip">SKRoot(Pro) - Linux内核级完美隐藏ROOT演示</span>
			<span class="desc-tip">新一代SKRoot，挑战全网root检测手段，跟面具完全不同思路，摆脱面具被检测的弱点，完美隐藏root功能，实现SELinux
				0%触碰，通杀所有内核，不需要内核源码，直接patch内核。模块特质：支持热修改Hook内核，最高支持10万个Hook位置，且无性能损耗。</span>
			<span class="warning-tip">当前是寄生模式，你可卸载原来的管理APP，避免管理APP被侦测。</span>
			<div class="divider"></div>
		</div>
		<div class="second-part">
			<div class="menu-list">
				<span class="menu-head-text">菜单功能列表：</span>
				<button class="btn" onclick="testInstallBtnClick()">1. 测试ROOT权限</button>
				<button class="btn" onclick="runRootCmdBtnClick()">2. 执行ROOT命令</button>
				<button class="btn" onclick="rootExecProcBtnClick()">3. 以ROOT执行程序</button>
			</div>

			<div class="vertical" aria-hidden="true"></div>
			<div class="output-list">
				<span class="menu-head-text">输出信息:</span>
				<div class="output-tool-list">
					<button class="small-btn" onclick="copyConsoleBtnClick()">复制</button>
					<button class="small-btn" onclick="clearConsoleBtnClick()">清空</button>
				</div>
				<textarea id="console" class="console" placeholder=""></textarea>
			</div>
		</div>
	</div>

	<!-- 授权 -->
	<div id="auth" class="tab-page" role="region" aria-label="授权">
		<div class="first-part">
			<span class="head-tip">授权中心</span>
			<span class="desc-tip">在这里管理许可证、设备绑定与校验结果。TODO描述</span>
			<div class="divider"></div>
		</div>
		<div class="second-part">
			<div class="output-list" style="width:100%">
				<span class="menu-head-text">授权信息:</span>
				<textarea class="console" readonly>（示例）未检测到许可证。
设备指纹：待生成...
        </textarea>
			</div>
		</div>
	</div>

	<!-- 模块 -->
	<div id="modules" class="tab-page" role="region" aria-label="模块">
		<div class="first-part">
			<span class="head-tip">模块管理</span>
			<span class="desc-tip">启用/停用模块、查看版本号与运行状态。TODO描述。</span>
			<div class="divider"></div>
		</div>
		<div class="second-part">
			<div class="output-list" style="width:100%">
				<span class="menu-head-text">模块列表:</span>
				<textarea class="console" readonly>111
2222
3333
        </textarea>
			</div>
		</div>
	</div>

	<!-- 设置 -->
	<div id="settings" class="tab-page" role="region" aria-label="设置">
		<div class="first-part">
			<span class="head-tip">设置</span>
			<span class="desc-tip">TODO描述。</span>
			<div class="divider"></div>
		</div>
		<div class="second-part">
			<div class="menu-list" style="min-width: 260px;">
				<span class="menu-head-text">常用设置：</span>
				<button class="btn" onclick="alert('TODO')">按钮</button>
				<button class="btn" onclick="alert('TODO')">按钮</button>
				<button class="btn" onclick="alert('TODO')">按钮</button>
			</div>
			<div class="vertical" aria-hidden="true"></div>
			<div class="output-list">
				<span class="menu-head-text">TODO:</span>
				<textarea class="console" readonly>theme=auto
log.level=info
heartbeat.interval.ms=500
        </textarea>
			</div>
		</div>
	</div>

	<!-- 底部固定Tab栏 -->
	<nav class="tabbar" role="tablist" aria-label="底部导航">
		<button class="tab-item active" data-tab="home" role="tab" aria-selected="true"
			onclick="switchTab('home')">主页</button>
		<button class="tab-item" data-tab="auth" role="tab" aria-selected="false"
			onclick="switchTab('auth')">授权</button>
		<button class="tab-item" data-tab="modules" role="tab" aria-selected="false"
			onclick="switchTab('modules')">模块</button>
		<button class="tab-item" data-tab="settings" role="tab" aria-selected="false"
			onclick="switchTab('settings')">设置</button>
	</nav>
</body>

</html>